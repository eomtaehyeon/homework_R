---
title: "Example_10_1"
author: "Eom_Taehyeon"
date: '2022-03-14'

---



# 사례 분석 10-1 서울 미세먼지 분석

## 1. 데이터 전처리



### 1) 파일 불러오기


```r
library(dplyr)
```

```
## Warning: 패키지 'dplyr'는 R 버전 4.1.3에서 작성되었습니다
```

```
## 
## 다음의 패키지를 부착합니다: 'dplyr'
```

```
## The following objects are masked from 'package:stats':
## 
##     filter, lag
```

```
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
```

```r
library(ggplot2)
```

```
## Warning: 패키지 'ggplot2'는 R 버전 4.1.3에서 작성되었습니다
```

```r
library(readxl)
```

```
## Warning: 패키지 'readxl'는 R 버전 4.1.3에서 작성되었습니다
```

```r
seoulair<-read_excel("서울대기오염_2019.xlsx")

str(seoulair)
```

```
## tibble [9,491 x 8] (S3: tbl_df/tbl/data.frame)
##  $ 날짜                   : chr [1:9491] "전체" "2019-12-31" "2019-12-31" "2019-12-31" ...
##  $ 측정소명               : chr [1:9491] "평균" "평균" "강남구" "강동구" ...
##  $ 미세먼지               : num [1:9491] 42 26 22 27 31 29 36 22 25 23 ...
##  $ 초미세먼지             : num [1:9491] 25 15 14 19 17 16 18 10 16 18 ...
##  $ 오존                   : num [1:9491] 0.025 0.022 0.025 0.019 0.022 0.022 0.026 0.019 0.022 0.019 ...
##  $ 이산화질소
## NO2 (ppm): num [1:9491] 0.028 0.016 0.014 0.02 0.022 0.017 0.013 0.016 0.02 0.019 ...
##  $ 일산화탄소
## CO (ppm) : num [1:9491] 0.5 0.4 0.4 0.4 0.4 0.4 0.4 0.4 0.3 0.4 ...
##  $ 아황산가스
## SO2(ppm) : num [1:9491] 0.004 0.003 0.003 0.003 0.002 0.004 0.003 0.002 0.004 0.003 ...
```
### 2) 분석 변수 추출, 변수이름 변경


```r
seoulair <- seoulair%>%
  rename(date="날짜",
         district="측정소명",
         pm10="미세먼지",
         pm2.5="초미세먼지")%>%
  select(date, district, pm10, pm2.5)  
```

### 3) 변수의 결측치, 이상치 확인하고 처리하기


#### (1) 문자형 변수


```r
table(seoulair$date)
```

```
## 
## 2019-01-01 2019-01-02 2019-01-03 2019-01-04 2019-01-05 2019-01-06 2019-01-07 
##         26         26         26         26         26         26         26 
## 2019-01-08 2019-01-09 2019-01-10 2019-01-11 2019-01-12 2019-01-13 2019-01-14 
##         26         26         26         26         26         26         26 
## 2019-01-15 2019-01-16 2019-01-17 2019-01-18 2019-01-19 2019-01-20 2019-01-21 
##         26         26         26         26         26         26         26 
## 2019-01-22 2019-01-23 2019-01-24 2019-01-25 2019-01-26 2019-01-27 2019-01-28 
##         26         26         26         26         26         26         26 
## 2019-01-29 2019-01-30 2019-01-31 2019-02-01 2019-02-02 2019-02-03 2019-02-04 
##         26         26         26         26         26         26         26 
## 2019-02-05 2019-02-06 2019-02-07 2019-02-08 2019-02-09 2019-02-10 2019-02-11 
##         26         26         26         26         26         26         26 
## 2019-02-12 2019-02-13 2019-02-14 2019-02-15 2019-02-16 2019-02-17 2019-02-18 
##         26         26         26         26         26         26         26 
## 2019-02-19 2019-02-20 2019-02-21 2019-02-22 2019-02-23 2019-02-24 2019-02-25 
##         26         26         26         26         26         26         26 
## 2019-02-26 2019-02-27 2019-02-28 2019-03-01 2019-03-02 2019-03-03 2019-03-04 
##         26         26         26         26         26         26         26 
## 2019-03-05 2019-03-06 2019-03-07 2019-03-08 2019-03-09 2019-03-10 2019-03-11 
##         26         26         26         26         26         26         26 
## 2019-03-12 2019-03-13 2019-03-14 2019-03-15 2019-03-16 2019-03-17 2019-03-18 
##         26         26         26         26         26         26         26 
## 2019-03-19 2019-03-20 2019-03-21 2019-03-22 2019-03-23 2019-03-24 2019-03-25 
##         26         26         26         26         26         26         26 
## 2019-03-26 2019-03-27 2019-03-28 2019-03-29 2019-03-30 2019-03-31 2019-04-01 
##         26         26         26         26         26         26         26 
## 2019-04-02 2019-04-03 2019-04-04 2019-04-05 2019-04-06 2019-04-07 2019-04-08 
##         26         26         26         26         26         26         26 
## 2019-04-09 2019-04-10 2019-04-11 2019-04-12 2019-04-13 2019-04-14 2019-04-15 
##         26         26         26         26         26         26         26 
## 2019-04-16 2019-04-17 2019-04-18 2019-04-19 2019-04-20 2019-04-21 2019-04-22 
##         26         26         26         26         26         26         26 
## 2019-04-23 2019-04-24 2019-04-25 2019-04-26 2019-04-27 2019-04-28 2019-04-29 
##         26         26         26         26         26         26         26 
## 2019-04-30 2019-05-01 2019-05-02 2019-05-03 2019-05-04 2019-05-05 2019-05-06 
##         26         26         26         26         26         26         26 
## 2019-05-07 2019-05-08 2019-05-09 2019-05-10 2019-05-11 2019-05-12 2019-05-13 
##         26         26         26         26         26         26         26 
## 2019-05-14 2019-05-15 2019-05-16 2019-05-17 2019-05-18 2019-05-19 2019-05-20 
##         26         26         26         26         26         26         26 
## 2019-05-21 2019-05-22 2019-05-23 2019-05-24 2019-05-25 2019-05-26 2019-05-27 
##         26         26         26         26         26         26         26 
## 2019-05-28 2019-05-29 2019-05-30 2019-05-31 2019-06-01 2019-06-02 2019-06-03 
##         26         26         26         26         26         26         26 
## 2019-06-04 2019-06-05 2019-06-06 2019-06-07 2019-06-08 2019-06-09 2019-06-10 
##         26         26         26         26         26         26         26 
## 2019-06-11 2019-06-12 2019-06-13 2019-06-14 2019-06-15 2019-06-16 2019-06-17 
##         26         26         26         26         26         26         26 
## 2019-06-18 2019-06-19 2019-06-20 2019-06-21 2019-06-22 2019-06-23 2019-06-24 
##         26         26         26         26         26         26         26 
## 2019-06-25 2019-06-26 2019-06-27 2019-06-28 2019-06-29 2019-06-30 2019-07-01 
##         26         26         26         26         26         26         26 
## 2019-07-02 2019-07-03 2019-07-04 2019-07-05 2019-07-06 2019-07-07 2019-07-08 
##         26         26         26         26         26         26         26 
## 2019-07-09 2019-07-10 2019-07-11 2019-07-12 2019-07-13 2019-07-14 2019-07-15 
##         26         26         26         26         26         26         26 
## 2019-07-16 2019-07-17 2019-07-18 2019-07-19 2019-07-20 2019-07-21 2019-07-22 
##         26         26         26         26         26         26         26 
## 2019-07-23 2019-07-24 2019-07-25 2019-07-26 2019-07-27 2019-07-28 2019-07-29 
##         26         26         26         26         26         26         26 
## 2019-07-30 2019-07-31 2019-08-01 2019-08-02 2019-08-03 2019-08-04 2019-08-05 
##         26         26         26         26         26         26         26 
## 2019-08-06 2019-08-07 2019-08-08 2019-08-09 2019-08-10 2019-08-11 2019-08-12 
##         26         26         26         26         26         26         26 
## 2019-08-13 2019-08-14 2019-08-15 2019-08-16 2019-08-17 2019-08-18 2019-08-19 
##         26         26         26         26         26         26         26 
## 2019-08-20 2019-08-21 2019-08-22 2019-08-23 2019-08-24 2019-08-25 2019-08-26 
##         26         26         26         26         26         26         26 
## 2019-08-27 2019-08-28 2019-08-29 2019-08-30 2019-08-31 2019-09-01 2019-09-02 
##         26         26         26         26         26         26         26 
## 2019-09-03 2019-09-04 2019-09-05 2019-09-06 2019-09-07 2019-09-08 2019-09-09 
##         26         26         26         26         26         26         26 
## 2019-09-10 2019-09-11 2019-09-12 2019-09-13 2019-09-14 2019-09-15 2019-09-16 
##         26         26         26         26         26         26         26 
## 2019-09-17 2019-09-18 2019-09-19 2019-09-20 2019-09-21 2019-09-22 2019-09-23 
##         26         26         26         26         26         26         26 
## 2019-09-24 2019-09-25 2019-09-26 2019-09-27 2019-09-28 2019-09-29 2019-09-30 
##         26         26         26         26         26         26         26 
## 2019-10-01 2019-10-02 2019-10-03 2019-10-04 2019-10-05 2019-10-06 2019-10-07 
##         26         26         26         26         26         26         26 
## 2019-10-08 2019-10-09 2019-10-10 2019-10-11 2019-10-12 2019-10-13 2019-10-14 
##         26         26         26         26         26         26         26 
## 2019-10-15 2019-10-16 2019-10-17 2019-10-18 2019-10-19 2019-10-20 2019-10-21 
##         26         26         26         26         26         26         26 
## 2019-10-22 2019-10-23 2019-10-24 2019-10-25 2019-10-26 2019-10-27 2019-10-28 
##         26         26         26         26         26         26         26 
## 2019-10-29 2019-10-30 2019-10-31 2019-11-01 2019-11-02 2019-11-03 2019-11-04 
##         26         26         26         26         26         26         26 
## 2019-11-05 2019-11-06 2019-11-07 2019-11-08 2019-11-09 2019-11-10 2019-11-11 
##         26         26         26         26         26         26         26 
## 2019-11-12 2019-11-13 2019-11-14 2019-11-15 2019-11-16 2019-11-17 2019-11-18 
##         26         26         26         26         26         26         26 
## 2019-11-19 2019-11-20 2019-11-21 2019-11-22 2019-11-23 2019-11-24 2019-11-25 
##         26         26         26         26         26         26         26 
## 2019-11-26 2019-11-27 2019-11-28 2019-11-29 2019-11-30 2019-12-01 2019-12-02 
##         26         26         26         26         26         26         26 
## 2019-12-03 2019-12-04 2019-12-05 2019-12-06 2019-12-07 2019-12-08 2019-12-09 
##         26         26         26         26         26         26         26 
## 2019-12-10 2019-12-11 2019-12-12 2019-12-13 2019-12-14 2019-12-15 2019-12-16 
##         26         26         26         26         26         26         26 
## 2019-12-17 2019-12-18 2019-12-19 2019-12-20 2019-12-21 2019-12-22 2019-12-23 
##         26         26         26         26         26         26         26 
## 2019-12-24 2019-12-25 2019-12-26 2019-12-27 2019-12-28 2019-12-29 2019-12-30 
##         26         26         26         26         26         26         26 
## 2019-12-31       전체 
##         26          1
```

```r
table(seoulair$district)
```

```
## 
##   강남구   강동구   강북구   강서구   관악구   광진구   구로구   금천구 
##      365      365      365      365      365      365      365      365 
##   노원구   도봉구 동대문구   동작구   마포구 서대문구   서초구   성동구 
##      365      365      365      365      365      365      365      365 
##   성북구   송파구   양천구 영등포구   용산구   은평구   종로구     중구 
##      365      365      365      365      365      365      365      365 
##   중랑구     평균 
##      365      366
```

```r
# seoul에서 date가 '전체'가 아니고, district가 '평균'이 아닌 데이터 추출
seoulair<-seoulair%>%filter(date!="전체"&district!="평균")
```


#### (2) 실수형 변수


```r
summary(seoulair$pm10)
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##    3.00   24.00   36.00   41.76   52.00  228.00     213
```

```r
summary(seoulair$pm2.5)
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##    1.00   14.00   21.00   24.93   30.00  153.00     203
```

### 4) 파생변수 만들기


#### (1) month, day 만들기


```r
seoulair$month<-substr(seoulair$date,6,7)

# str() 함수에서 2019-01-01 형태로 월은 데이터 6~7번째

seoulair$day<-substr(seoulair$date,9,10)

# str() 함수에서 2019-01-01 형태로 일은 데이터 9~10 번째
```

```r
class(seoulair$month)
```

```
## [1] "character"
```

```r
# month 변수 유형 확인 
class(seoulair$day)
```

```
## [1] "character"
```

```r
# day 변수 유형 확인
```

#### (2) season 변수 만들기


```r
seoulair$month<-as.numeric(seoulair$month)

seoulair$day<-as.numeric(seoulair$day)

seoulair$season<-
  ifelse(seoulair$month %in% c("3","4","5"),"spring",
         ifelse(seoulair$month %in% c(6,7,8), "summer",
                ifelse(seoulair$month %in% c(9,10,11),"autumn","winter")))
```


### 5) 분석 데이터 최종 확인

```r
str(seoulair)
```

```
## tibble [9,125 x 7] (S3: tbl_df/tbl/data.frame)
##  $ date    : chr [1:9125] "2019-12-31" "2019-12-31" "2019-12-31" "2019-12-31" ...
##  $ district: chr [1:9125] "강남구" "강동구" "강북구" "강서구" ...
##  $ pm10    : num [1:9125] 22 27 31 29 36 22 25 23 22 19 ...
##  $ pm2.5   : num [1:9125] 14 19 17 16 18 10 16 18 17 12 ...
##  $ month   : num [1:9125] 12 12 12 12 12 12 12 12 12 12 ...
##  $ day     : num [1:9125] 31 31 31 31 31 31 31 31 31 31 ...
##  $ season  : chr [1:9125] "winter" "winter" "winter" "winter" ...
```

## 2. 데이터 분석

### 1) 연간 미세먼지 평균 알아보기

```r
mean(seoulair$pm10,na.rm = T) # 미세먼지 평균 구하기 mean() # na.rm 
```

```
## [1] 41.76167
```

```r
# 미세먼지 평균은 41.8
```
### 2) 미세먼지가 가장 심했던 날짜 알아보기

```r
seoulair%>%  
  filter(!is.na(pm10))%>%          # 결측치 없는 pm10 자료만 추출
  filter(pm10==max(pm10))%>%             # pm10 최댓값 행 추출
  select(date,district,pm10)              # 3개 변수만 출력
```

```
## # A tibble: 1 x 3
##   date       district  pm10
##   <chr>      <chr>    <dbl>
## 1 2019-03-05 강북구     228
```

```r
# 2019년 3월 5일 강북구의 미세먼지수치가 228로 가장 높았다.
```

### 3) 구별 미세먼지 평균 비교


```r
seoulair%>%
  filter(!is.na(pm10))%>%           # pm10이 결측치가 아닌 행만 추출
  group_by(district)%>%              # 구를 기준으로 데이터 분류
  summarise(m=mean(pm10))%>%              #구별로 pm10 평균 구하기
  arrange(m)%>%                    # 평균을 기준으로 오름차순으로 정렬
  head(5)                                # 상위 5개 행을 출력
```

```
## # A tibble: 5 x 2
##   district     m
##   <chr>    <dbl>
## 1 용산구    34.1
## 2 중랑구    37.3
## 3 중구      37.6
## 4 종로구    37.7
## 5 도봉구    38.0
```
### 4) 계절별 분석


```r
seoulair%>% 
  filter(!is.na(pm10) &!is.na(pm2.5))%>%   # pm10과 pm2.5의 결측치 동시 제거
  group_by(season)%>%                    # season 변수로 데이터 분류
  summarise(m1=mean(pm10),               # pm10과 pm2.5의 평균 구하기
            m2=mean(pm2.5))%>% 
  arrange(m1)                            # pm10 평균을 기준으로 오름차순 정렬
```

```
## # A tibble: 4 x 3
##   season    m1    m2
##   <chr>  <dbl> <dbl>
## 1 summer  26.3  18.1
## 2 autumn  31.1  15.7
## 3 spring  54.1  31.6
## 4 winter  54.7  33.7
```

```r
# 미세먼지의 하루평균은 여름이 낮고, 겨울이 높음
# 초미세먼지의 하루평균은 가을이 낮고 겨울이 높다 
```


### 5) 미세먼지 등급 분석


```r
seoulair%>%
  filter(!is.na(pm10))%>%                      # pm10이 결측치가 아닌 데이터 추출
  mutate(pm_grade=ifelse(pm10<=30,"good",                 # pm_grade 변수 만들기
                         ifelse(pm10<=81, "normal",
                                ifelse(pm10<=150, "bad", "worse"))))%>%
  group_by(pm_grade)%>%                           # pm_grade 변수를 기준으로 분류
  summarise(n=n())%>%                          #pm_grade변수의 등급별 빈도 구하기
  mutate(total=sum(n),                           #pm_grade변수의 빈도 총계 구하기
         pct=round(n/total*100,1))%>%  #등급별 빈도의 백분율을 소수점 한자리까지 구하기
  select(pm_grade,n,pct)%>%                                 # 출력 변수 지정
  arrange(desc(n))                                  #빈도 기준으로 내림차순 정렬
```

```
## # A tibble: 4 x 3
##   pm_grade     n   pct
##   <chr>    <int> <dbl>
## 1 normal    4842  54.3
## 2 good      3412  38.3
## 3 bad        577   6.5
## 4 worse       81   0.9
```

```r
# 'nomal'이 54.3%, 'good'이 38.3%로 전체의 92.6%이다. 미세먼지 실태가 나쁘지 않다.
```
### 6) 구별 미세먼지 등급 비교


```r
seoulair%>%
  filter(!is.na(pm10))%>%
  mutate(pm_grade=ifelse(pm10<=30,"good",
                         ifelse(pm10<=81, "normal",
                                ifelse(pm10<=150, "bad", "worse"))))%>%
  group_by(district,pm_grade)%>%  # district별로 pm_grade 등급분류
  summarise(n=n())%>%  # district별로 pm_grade 등급빈도구하기
  mutate(total=sum(n),  # district별로 빈도총계 구하기
         pct=round(n/total*100,1))%>%  # district별로 pm_grade 등급별 백분율 구하기
  filter(pm_grade=="good")%>%  #good등급 데이터만 추출
  select(district,n,pct)%>%  # 3개 변수만 추출
  arrange(desc(pct))%>%  # 백분율 기준으로 내림차순 정렬
  head(5)
```

```
## `summarise()` has grouped output by 'district'. You can override using the
## `.groups` argument.
```

```
## # A tibble: 5 x 3
## # Groups:   district [5]
##   district     n   pct
##   <chr>    <int> <dbl>
## 1 용산구     196  54  
## 2 중구       169  46.3
## 3 중랑구     151  46.2
## 4 종로구     163  44.7
## 5 금천구     161  44.4
```

```r
# 미세먼지는 용산구가 54%로 가장 높다. 1년 중 196일이 good 등급이다.
```

### 7) 1년간 미세먼지 추이를 그래프로 그리기

x축을 date, y축을 pm10으로 하는 선그래프를 그립니다.


```r
ggplot(data=seoulair, aes(x=date, y=pm10))+geom_line()
```

```
## Warning: Removed 48 row(s) containing missing values (geom_path).
```

![](/images/Example_10_1_files/figure-html/unnamed-chunk-17-1.png)<!-- -->


### 8) 계절별 미세먼지 등급 비율 그래프 그리기


```r
# season_grade 객체 만들기

season_grade <- seoulair%>%
           filter(!is.na(pm10))%>%
           mutate(pm_grade=ifelse(pm10<=30,"good",
                                  ifelse(pm10<=81, "normal",
                                         ifelse(pm10<=150, "bad", "worse"))))%>%
           group_by(season, pm_grade)%>%
           summarise(n=n())%>%
           mutate(total=sum(n),
                  pct=round(n/total*100,1))%>%
  select(season,pm_grade,pct)
```

```
## `summarise()` has grouped output by 'season'. You can override using the
## `.groups` argument.
```

```r
# 그래프 그리기

ggplot(data = season_grade, aes(x=season, y=pct, fill=pm_grade))+
  geom_col(position="dodge")+
  scale_x_discrete(limits=c("spring","summer","autumn","winter"))+
  ggtitle("2019년 서울의 계절별 미세먼지 실태")+
  xlab("계절")+
  ylab("등급별 비율")
```

![](/images/Example_10_1_files/figure-html/unnamed-chunk-18-1.png)<!-- -->


## 연습문제 10 - 1 

### 1. 2019년 서울의 초미세먼지 평균을 알아봅니다.


```r
mean(seoulair$pm2.5, na.rm = T)
```

```
## [1] 24.93096
```

```r
# 24.93096 으로 '보통' 수준입니다.
```
### 2. 계절별로 초미세먼지가 가장 심했던 날짜를 찾아서 계절, 날짜, 구, 초미세먼지 데이터만 순서대로 출력하세요.
#### filter(), group_by(), max(), select() 함수를 조합해서 분석합니다.


```r
seoulair%>%
  filter(!is.na(pm2.5))%>%
  group_by(season)%>%
  filter(pm2.5==max(pm2.5))%>%
  select(season,date,district,pm2.5)
```

```
## # A tibble: 5 x 4
## # Groups:   season [4]
##   season date       district pm2.5
##   <chr>  <chr>      <chr>    <dbl>
## 1 autumn 2019-11-03 구로구      52
## 2 autumn 2019-11-02 구로구      52
## 3 summer 2019-07-17 성동구      69
## 4 spring 2019-03-05 성동구     153
## 5 winter 2019-01-14 강남구     148
```


### 3. 25개 구의 연간 초미세먼지 평균을 구하고, 평균의 내림차순으로 막대그래프를 그리세요. 막대그래프를 90도 회전시켜서 y축에 구 이름이 표시되도록 합니다. x축과 y축의 이름은 지정하지 않아도 됩니다. 



```r
district_pm2.5 <-seoulair%>% 
  filter(!is.na(pm2.5))%>%  # 결측치가 없는 pm.25 데이터 추출
  group_by(district)%>%  # district 변수로 분류
  summarise(m=mean(pm2.5))  # district별 평균 구하기

ggplot(data=district_pm2.5, aes(x=reorder(district,m), y=m))+   # 막대그래프 내림차순 정렬할때 reorder() 함수를 이용
         geom_col()+
         coord_flip()                                           # 막대그래프를 90도 회전할 때는 coord_flip() 함수를 이용
```

![](/images/Example_10_1_files/figure-html/unnamed-chunk-21-1.png)<!-- -->

### 4. 연간 초미세먼지 평균이 가장 높은 구와 낮은 구의 평균이 통계적으로 차이가 있는가를 검정합니다.


```r
# 최대, 최소 구 알아보기
seoulair%>%
  filter(!is.na(pm2.5))%>%
  group_by(district)%>%
  summarise(m=mean(pm2.5))%>%  # 구별 평균 구하기
  filter(m==max(m)|m==min(m))  # 평균이 최대인 구와 최소인 구를 동시에 추출
```

```
## # A tibble: 2 x 2
##   district     m
##   <chr>    <dbl>
## 1 성북구    22.0
## 2 영등포구  28.8
```

```r
# 2개 구의 데이터를 추출해서 별도 객체에 저장
district_2 <-seoulair %>% 
  filter(district %in% c("성북구","영등포구"))

# 2개 구의 평균 차이
t.test(data=district_2,pm2.5~district)
```

```
## 
## 	Welch Two Sample t-test
## 
## data:  pm2.5 by district
## t = -4.9996, df = 694.37, p-value = 7.284e-07
## alternative hypothesis: true difference in means between group 성북구 and group 영등포구 is not equal to 0
## 95 percent confidence interval:
##  -9.482526 -4.134825
## sample estimates:
##   mean in group 성북구 mean in group 영등포구 
##               21.96667               28.77534
```

